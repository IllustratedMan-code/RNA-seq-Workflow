<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <!-- 2021-05-19 Wed 09:40 -->
  <meta http-equiv="Content-Type" content=
  "text/html; charset=utf-8" />
  <meta name="viewport" content=
  "width=device-width, initial-scale=1" />
  <title>RNA-seq Leg Vs Body workflow</title>
  <meta name="author" content="David Lewis" />
  <meta name="generator" content="Org Mode" />
  <style type="text/css">
  <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
  </style>
  <link rel="stylesheet" type="text/css" href=
  "https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css" />
  <link rel="stylesheet" type="text/css" href=
  "https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css" />

  <script src=
  "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src=
  "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" src=
  "https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
  <script type="text/javascript" src=
  "https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
  <script type="text/javascript">
  // @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
  <!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
  // @license-end
  </script>
</head>
<body>
  <div id="content">
    <h1 class="title">RNA-seq Leg Vs Body workflow</h1>
    <div id="table-of-contents">
      <h2>Table of Contents</h2>
      <div id="text-table-of-contents">
        <ul>
          <li><a href="#org35df586">1. Introduction</a></li>
          <li><a href="#org98f7d36">2. Galaxy</a></li>
          <li>
            <a href="#org3fc506b">3. R functions</a>
            <ul>
              <li><a href="#org599fa09">3.1. txi function</a></li>
              <li><a href="#org15ef5b3">3.2. Initial Deseq
              Function</a></li>
              <li><a href="#orgf8dbb06">3.3. ReDeseq</a></li>
              <li><a href="#orgb3b1ea0">3.4. initialEdgeR</a></li>
              <li><a href="#org475ac1e">3.5. estEdgeR</a></li>
            </ul>
          </li>
          <li>
            <a href="#orgededa30">4. initial R step</a>
            <ul>
              <li>
                <a href="#org7538aa7">4.1. <span class=
                "todo TODO">TODO</span> Deseq</a>
                <ul>
                  <li><a href="#org315e4a0">4.1.1. Package
                  imports</a></li>
                  <li><a href="#org0ff49ec">4.1.2.
                  Tximport</a></li>
                  <li><a href="#org9c13482">4.1.3. Create the Deseq
                  Object</a></li>
                  <li><a href="#org78abb55">4.1.4. Do initial data
                  manipulation</a></li>
                  <li><a href="#org0e1d0f2">4.1.5. Initial
                  selection of the data</a></li>
                  <li><a href="#org87b407d">4.1.6. Save lists of
                  the respective up-regulated genes</a></li>
                  <li><a href="#org2a5a15e">4.1.7. Create a new
                  analysis design</a></li>
                  <li><a href="#org2bd61f9">4.1.8. Prepare the data
                  for pheatmap plotting</a></li>
                  <li><a href="#org13d8838">4.1.9. Integrity
                  plots</a></li>
                  <li><a href="#org6a781d1">4.1.10. Another Deseq
                  Design</a></li>
                  <li><a href="#org2f9f6a4">4.1.11. Altered
                  Selection of genes</a></li>
                  <li><a href="#org8c7c5a7">4.1.12. Save new
                  selection to file</a></li>
                  <li><a href="#org920e013">4.1.13. Extra integrity
                  plot</a></li>
                  <li><a href="#orgded38dd">4.1.14. <span class=
                  "todo TODO">TODO</span> Extra EdgeR for venn
                  diagrams</a></li>
                </ul>
              </li>
              <li>
                <a href="#orgaf886bd">4.2. EdgeR</a>
                <ul>
                  <li><a href="#org9a2e6f0">4.2.1. Initial
                  settings</a></li>
                  <li><a href="#orgbed31c2">4.2.2. Do the initial
                  processing of the data</a></li>
                  <li><a href="#orgf695ace">4.2.3. Partion the data
                  into body and leg tables</a></li>
                  <li><a href="#orga85c1f4">4.2.4. Save the data
                  tables to a file</a></li>
                  <li><a href="#orgd77a44b">4.2.5. Find the
                  relative expression values when compared to the
                  control</a></li>
                  <li><a href="#orgd98723b">4.2.6. Selection of the
                  data</a></li>
                  <li><a href="#orga93e2f7">4.2.7. Create a csv for
                  bar plotting</a></li>
                  <li><a href="#org058d359">4.2.8. Gets the
                  row-names</a></li>
                  <li><a href="#orgb916788">4.2.9. Create a list of
                  dataframes corresponding to the total, leg, and
                  body</a></li>
                  <li><a href="#orge808cc6">4.2.10. Save the
                  genelist to files</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a href="#org3398bc5">5. Fasta Manipulation</a>
            <ul>
              <li><a href="#orgb2cfdc6">5.1. Get Gene
              names</a></li>
            </ul>
          </li>
          <li><a href="#org6350d84">6. Blast</a></li>
          <li>
            <a href="#org2ccb604">7. Plotting</a>
            <ul>
              <li>
                <a href="#org52bf935">7.1. Required Packages</a>
                <ul>
                  <li><a href="#orgcf806c3">7.1.1. R
                  packages</a></li>
                  <li><a href="#org68ed04a">7.1.2. Python
                  packages</a></li>
                </ul>
              </li>
              <li>
                <a href="#org1b10c20">7.2. Venn Diagrams</a>
                <ul>
                  <li><a href="#org7c6d3d7">7.2.1. Imports</a></li>
                  <li><a href="#org2771181">7.2.2. Venn 1</a></li>
                  <li><a href="#orgd96958e">7.2.3. Venn 2</a></li>
                  <li><a href="#org1923289">7.2.4. Venn 3</a></li>
                  <li><a href="#org37ce54e">7.2.5. Venn 4</a></li>
                  <li><a href="#org18dedf3">7.2.6. Venn 5</a></li>
                  <li><a href="#org55791e5">7.2.7. Venn 6</a></li>
                  <li><a href="#orgb644410">7.2.8. Venn 7</a></li>
                  <li><a href="#orgf070555">7.2.9. Venn 8</a></li>
                </ul>
              </li>
              <li>
                <a href="#orgd0c9136">7.3. Pearson Correlation</a>
                <ul>
                  <li><a href="#org7ded9eb">7.3.1.
                  Libraries</a></li>
                  <li><a href="#org4daa1fc">7.3.2. Import the
                  data</a></li>
                  <li><a href="#org00262bd">7.3.3. Plot the
                  data</a></li>
                  <li><a href="#orgfabe93d">7.3.4. Venn
                  Diagram</a></li>
                </ul>
              </li>
              <li>
                <a href="#orge733bf1">7.4. Dotplot</a>
                <ul>
                  <li><a href="#org32b8c95">7.4.1. imports</a></li>
                  <li><a href="#org101ec2c">7.4.2. Theme
                  settings</a></li>
                  <li><a href="#org097ecf0">7.4.3. Import</a></li>
                  <li><a href="#orge3dca6e">7.4.4. Plot the
                  figure</a></li>
                  <li><a href="#org763e16e">7.4.5. Save the
                  Figure</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div id="outline-container-org35df586" class="outline-2">
      <h2 id="org35df586"><span class="section-number-2">1</span>
      Introduction</h2>
      <div class="outline-text-2" id="text-1">
        <ul class="org-ul">
          <li>The Ticks are sprayed with Permethrin and DEET</li>
          <li>The Legs are separated from the bodies of the ticks
          and analyzed separately</li>
          <li>The Fasta files + assembly are sent to Galaxy</li>
        </ul>
      </div>
    </div>
    <div id="outline-container-org98f7d36" class="outline-2">
      <h2 id="org98f7d36"><span class="section-number-2">2</span>
      Galaxy</h2>
      <div class="outline-text-2" id="text-2">
        <ul class="org-ul">
          <li>Import the fasta files + assembly to Galaxy</li>
          <li>Run FastQC to determine data integrity and quality on
          each fasta</li>
          <li>Run Trimmomatic to trim superfluous data from the
          fasta files</li>
          <li>Run A fish analysis tool on the data (salmon,
          sailfish, kallisto quant) on each fasta file from
          trimmomatic. This requires the assembly as an input</li>
          <li>Export the quant files for local analysis with R</li>
        </ul>
      </div>
    </div>
    <div id="outline-container-org3fc506b" class="outline-2">
      <h2 id="org3fc506b"><span class="section-number-2">3</span> R
      functions</h2>
      <div class="outline-text-2" id="text-3"></div>
      <div id="outline-container-org599fa09" class="outline-3">
        <h3 id="org599fa09"><span class=
        "section-number-3">3.1</span> txi function</h3>
        <div class="outline-text-3" id="text-3-1">
          <p>uses the tximport package to import the quant data.
          The tximport package is used in both deseq and edgeR for
          data import. It is optional, but saves a lot of time on
          initial data organization</p>
          <div class="org-src-container">
            <pre class="src src-jupyter-R"><span style=
            "color: #b8bb26;">txi</span> <span style=
            "color: #d3869b;">&lt;-</span> <span style=
            "color: #fb4934;">function</span>(directory, quantdatafoldername, metadata, fishtype){
  <span style="color: #d3869b;">library</span>(tximport)
  <span style="color: #d3869b;">setwd</span>(directory)
  metadata <span style=
"color: #d3869b;">&lt;-</span> read.csv(metadata, header=<span style="color: #fabd2f;">TRUE</span>)
  files <span style=
"color: #d3869b;">&lt;-</span> file.path(directory, quantdatafoldername, metadata$name)
  names(files) <span style=
"color: #d3869b;">&lt;-</span> metadata$name
  genes <span style=
"color: #d3869b;">&lt;-</span> read.table(<span style=
"color: #b8bb26;">"genes2.tabular"</span>)
  txi <span style=
"color: #d3869b;">&lt;-</span> tximport(files, type=fishtype, tx2gene=genes)
  <span style="color: #fb4934;">return</span>(list(txi, metadata))
}
</pre>
          </div>
        </div>
      </div>
      <div id="outline-container-org15ef5b3" class="outline-3">
        <h3 id="org15ef5b3"><span class=
        "section-number-3">3.2</span> Initial Deseq Function</h3>
        <div class="outline-text-3" id="text-3-2">
          <p>Sets up the deseq data set object and returns it.
          Deseq uses a linear model to fit the data. Read more
          about it here <a href=
          "https://bioconductor.org/packages/release/bioc/vignettes/DESeq2/inst/doc/DESeq2.html#theory-behind-deseq2">
          Deseq2</a>.</p>
          <div class="org-src-container">
            <pre class="src src-jupyter-R"><span style=
            "color: #b8bb26;">initialDeseq</span> <span style=
            "color: #d3869b;">&lt;-</span> <span style=
            "color: #fb4934;">function</span>(txi, metadata, design=~part + pesticides){
  <span style="color: #d3869b;">library</span>(DESeq2)
  <span style="color: #928374;"># </span><span style=
"color: #928374;">Deseq2 dataset from tximport</span>
  data <span style=
"color: #d3869b;">&lt;-</span> DESeqDataSetFromTximport(txi, colData=metadata, design = design)
  Deseq <span style="color: #d3869b;">&lt;-</span> DESeq(data)
  results <span style="color: #d3869b;">&lt;-</span> results(Deseq)
  print(summary(results))
  <span style="color: #fb4934;">return</span>(list(Deseq, results))
}
</pre>
          </div>
        </div>
      </div>
      <div id="outline-container-orgf8dbb06" class="outline-3">
        <h3 id="orgf8dbb06"><span class=
        "section-number-3">3.3</span> ReDeseq</h3>
        <div class="outline-text-3" id="text-3-3">
          <p>sets up the deseq object with a different design
          criteria. The design changes how log2foldchange is
          expressed. It is more difficult to get multifactorial
          analysis in a single deseq object than with edgeR.
          Changing the design is necessary for complicated
          analysis.</p>
          <div class="org-src-container">
            <pre class="src src-jupyter-R"><span style=
            "color: #b8bb26;">reDeseq</span> <span style=
            "color: #d3869b;">&lt;-</span> <span style=
            "color: #fb4934;">function</span>(dds){
  ddsMF <span style="color: #d3869b;">&lt;-</span> dds
  design(ddsMF) <span style=
"color: #d3869b;">&lt;-</span> formula(~pesticides)
  ddsMF <span style="color: #d3869b;">&lt;-</span> DESeq(ddsMF)
  Mres <span style="color: #d3869b;">&lt;-</span> results(ddsMF)
  <span style="color: #fb4934;">return</span>(list(ddsMf, Mres))
  }
</pre>
          </div>
        </div>
      </div>
      <div id="outline-container-orgb3b1ea0" class="outline-3">
        <h3 id="orgb3b1ea0"><span class=
        "section-number-3">3.4</span> initialEdgeR</h3>
        <div class="outline-text-3" id="text-3-4">
          <p>Sets up the EdgeR object and returns it. EdgeR uses a
          different linear model. Read more about it here <a href=
          "https://www.bioconductor.org/packages/release/bioc/vignettes/edgeR/inst/doc/edgeRUsersGuide.pdf">
          edgeR</a>.</p>
          <div class="org-src-container">
            <pre class="src src-jupyter-R"><span style=
            "color: #b8bb26;">initialEdgeR</span> <span style=
            "color: #d3869b;">&lt;-</span> <span style=
            "color: #fb4934;">function</span>(txi, meta){
  <span style="color: #d3869b;">library</span>(edgeR)
  <span style="color: #928374;"># </span><span style=
"color: #928374;">EdgR dataset from tximport</span>
  counts <span style="color: #d3869b;">&lt;-</span> txi$counts
  length <span style="color: #d3869b;">&lt;-</span> txi$length
  normMat <span style=
"color: #d3869b;">&lt;-</span> length / exp(rowMeans(log(length)))
  normCts <span style=
"color: #d3869b;">&lt;-</span> counts / normMat
  eff.lib <span style=
"color: #d3869b;">&lt;-</span> calcNormFactors(normCts) * colSums(normCts)
  normMat <span style=
"color: #d3869b;">&lt;-</span> sweep(normMat, <span style=
"color: #d3869b; font-weight: bold;">2</span>, eff.lib, <span style="color: #b8bb26;">"*"</span>)
  normMat <span style="color: #d3869b;">&lt;-</span> log(normMat)
  y <span style="color: #d3869b;">&lt;-</span> DGEList(counts)
  y <span style=
"color: #d3869b;">&lt;-</span> scaleOffset(y, normMat)
  
  pest <span style=
"color: #d3869b;">&lt;-</span> factor(meta$pesticides, levels=c(<span style="color: #b8bb26;">"perm"</span>, <span style="color: #b8bb26;">"deet"</span>, <span style="color: #b8bb26;">"control"</span>))
  part <span style=
"color: #d3869b;">&lt;-</span> factor(meta$part, levels=c(<span style="color: #b8bb26;">"leg"</span>, <span style="color: #b8bb26;">"body"</span>))
  design <span style=
"color: #d3869b;">&lt;-</span> model.matrix(~<span style=
"color: #d3869b; font-weight: bold;">0</span> + pest + part)
  keep <span style=
"color: #d3869b;">&lt;-</span> filterByExpr(y, design)
  EdgeR <span style="color: #d3869b;">&lt;-</span> y[keep, ]
  <span style="color: #fb4934;">return</span>(list(EdgeR, design))
}
</pre>
          </div>
        </div>
      </div>
      <div id="outline-container-org475ac1e" class="outline-3">
        <h3 id="org475ac1e"><span class=
        "section-number-3">3.5</span> estEdgeR</h3>
        <div class="outline-text-3" id="text-3-5">
          <p>finds the fit of the data and returns it for further
          analysis. Uses the edgeR functions to estimate dispersion
          of the genes. It is much faster than deseq2.</p>
          <div class="org-src-container">
            <pre class="src src-jupyter-R"><span style=
            "color: #b8bb26;">estEdgeR</span> <span style=
            "color: #d3869b;">&lt;-</span> <span style=
            "color: #fb4934;">function</span>(EdgeR, design){
  <span style="color: #d3869b;">library</span>(edgeR)
  y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMCommonDisp(EdgeR, design)
  y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMTrendedDisp(y, design)
  y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMTagwiseDisp(y, design)
  fit <span style=
"color: #d3869b;">&lt;-</span> glmQLFit(y, design) 
  
  <span style="color: #fb4934;">return</span>(fit)
}
</pre>
          </div>
        </div>
      </div>
    </div>
    <div id="outline-container-orgededa30" class="outline-2">
      <h2 id="orgededa30"><span class="section-number-2">4</span>
      initial R step</h2>
      <div class="outline-text-2" id="text-4">
        <p>EdgeR and Deseq2 are used to find lists of genes that
        are up-regulated and down-regulated when compared to design
        criteria. The design is used to curated the value of
        logfoldchange in Deseq2. They are compared using a pearson
        correlation in the plotting section.</p>
      </div>
      <div id="outline-container-org7538aa7" class="outline-3">
        <h3 id="org7538aa7"><span class=
        "section-number-3">4.1</span> <span class=
        "todo TODO">TODO</span> Deseq</h3>
        <div class="outline-text-3" id="text-4-1">
          <p>This needs to incorporate the function definitions.
          Much of it is being restated in an unintuitive way</p>
        </div>
        <div id="outline-container-org315e4a0" class="outline-4">
          <h4 id="org315e4a0"><span class=
          "section-number-4">4.1.1</span> Package imports</h4>
          <div class="outline-text-4" id="text-4-1-1">
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-R">vignette(package=<span style=
              "color: #b8bb26;">"dplyr"</span>)

rdata <span style=
"color: #d3869b;">&lt;-</span> list.files(pattern=<span style=
"color: #b8bb26;">"\\.Rdata"</span>)
args <span style=
"color: #d3869b;">&lt;-</span> commandArgs(trailingOnly = <span style="color: #fabd2f;">TRUE</span>)
<span style=
"color: #fb4934;">if</span>(length(args) &gt; <span style=
"color: #d3869b; font-weight: bold;">0</span>){
    <span style="color: #fb4934;">if</span>(args == <span style=
"color: #b8bb26;">"rerun"</span>){
        print(<span style=
"color: #b8bb26;">"rerunning data"</span>)
        r
    }
}
<span style="color: #928374;"># </span><span style=
"color: #928374;">general library imports ----</span>
<span style="color: #d3869b;">library</span>(tximport)
<span style="color: #d3869b;">library</span>(readr)
<span style="color: #d3869b;">library</span>(<span style=
"color: #b8bb26;">"pheatmap"</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org0ff49ec" class="outline-4">
          <h4 id="org0ff49ec"><span class=
          "section-number-4">4.1.2</span> Tximport</h4>
          <div class="outline-text-4" id="text-4-1-2">
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #928374;">#</span><span style=
              "color: #928374;">change these values to your own situations</span>
directory <span style="color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/R/largeRNASEQ"</span>
quantdatafoldername <span style=
"color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"CorrectedQuantData"</span>
fishtype <span style="color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"sailfish"</span>
</pre>
            </div>
          </div>
          <ol class="org-ol">
            <li>
              <a id="org23f301c" name="org23f301c"></a>Convert
              quant files to txi object<br />
              <div class="outline-text-5" id="text-4-1-2-1">
                <div class="org-src-container">
                  <pre class="src src-jupyter-R"><span style=
                  "color: #928374;"># </span><span style=
                  "color: #928374;">imports the genes as a tximport file</span>
<span style="color: #d3869b;">setwd</span>(directory)
metadata <span style=
"color: #d3869b;">&lt;-</span> read.csv(<span style=
"color: #b8bb26;">"metadata.csv"</span>, header=<span style=
"color: #fabd2f;">TRUE</span>)
files <span style=
"color: #d3869b;">&lt;-</span> file.path(directory, quantdatafoldername, metadata$name)
names(files) <span style=
"color: #d3869b;">&lt;-</span> metadata$name
genes <span style=
"color: #d3869b;">&lt;-</span> read.table(<span style=
"color: #b8bb26;">"genes2.tabular"</span>)
txi <span style=
"color: #d3869b;">&lt;-</span> tximport(files, type=fishtype, tx2gene=genes)
</pre>
                </div>
                <pre class="example" id="org998c2ce">
reading in files with read_tsv

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17


summarizing abundance

summarizing counts

summarizing length
</pre>
              </div>
            </li>
          </ol>
        </div>
        <div id="outline-container-org9c13482" class="outline-4">
          <h4 id="org9c13482"><span class=
          "section-number-4">4.1.3</span> Create the Deseq
          Object</h4>
          <div class="outline-text-4" id="text-4-1-3">
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">library</span>(DESeq2)
<span style="color: #928374;"># </span><span style=
"color: #928374;">Deseq2 dataset from tximport</span>
data <span style=
"color: #d3869b;">&lt;-</span> DESeqDataSetFromTximport(txi, colData=metadata, design = ~part + pesticides)
Deseq <span style="color: #d3869b;">&lt;-</span> DESeq(data)
results <span style="color: #d3869b;">&lt;-</span> results(Deseq)
</pre>
            </div>
            <pre class="example" id="org1f66b2e">
Warning message in DESeqDataSet(se, design = design, ignoreRank):
“some variables in design formula are characters, converting to factors”
using counts and average transcript lengths from tximport

estimating size factors

using 'avgTxLength' from assays(dds), correcting for library size

estimating dispersions

gene-wise dispersion estimates

mean-dispersion relationship

final dispersion estimates

fitting model and testing
</pre>
          </div>
        </div>
        <div id="outline-container-org78abb55" class="outline-4">
          <h4 id="org78abb55"><span class=
          "section-number-4">4.1.4</span> Do initial data
          manipulation</h4>
          <div class="outline-text-4" id="text-4-1-4">
            <p>The part design is used to compare the leg to the
            body in total, disregarding pesticide. This is
            explained in detail in the pearson correlation
            section.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #928374;">## </span><span style=
              "color: #928374;">hello</span>
dds <span style="color: #d3869b;">&lt;-</span> Deseq
<span style="color: #928374;">#</span><span style=
"color: #928374;">* vsd ntd rld</span>
vsd <span style=
"color: #d3869b;">&lt;-</span> vst(dds, blind=<span style=
"color: #fabd2f;">FALSE</span>)
rld <span style=
"color: #d3869b;">&lt;-</span> rlog(dds, blind=<span style=
"color: #fabd2f;">FALSE</span>)
ntd <span style="color: #d3869b;">&lt;-</span> normTransform(dds)

ddsMF <span style="color: #d3869b;">&lt;-</span> dds
design(ddsMF) <span style=
"color: #d3869b;">&lt;-</span> formula(~pesticides)
ddsMF <span style="color: #d3869b;">&lt;-</span> DESeq(ddsMF)
Mres <span style="color: #d3869b;">&lt;-</span> results(ddsMF)
design(dds) <span style=
"color: #d3869b;">&lt;-</span> formula(~part)
part <span style="color: #d3869b;">&lt;-</span> DESeq(dds)
res <span style="color: #d3869b;">&lt;-</span> results(part)
</pre>
            </div>
            <pre class="example" id="org8058221">
using pre-existing normalization factors

estimating dispersions

found already estimated dispersions, replacing these

gene-wise dispersion estimates

mean-dispersion relationship

final dispersion estimates

fitting model and testing

using pre-existing normalization factors

estimating dispersions

found already estimated dispersions, replacing these

gene-wise dispersion estimates

mean-dispersion relationship

final dispersion estimates

fitting model and testing

-- replacing outliers and refitting for 4107 genes
-- DESeq argument 'minReplicatesForReplace' = 7
-- original counts are preserved in counts(dds)

estimating dispersions

fitting model and testing
</pre>
          </div>
        </div>
        <div id="outline-container-org0e1d0f2" class="outline-4">
          <h4 id="org0e1d0f2"><span class=
          "section-number-4">4.1.5</span> Initial selection of the
          data</h4>
          <div class="outline-text-4" id="text-4-1-5">
            <ul class="org-ul">
              <li>p value of less than 0.01</li>
              <li>Leg is compared to body, therefore down-regulated
              are up-regulated in body</li>
            </ul>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">DR <span style=
              "color: #d3869b;">&lt;-</span> Mres[ which(Mres$padj &lt; <span style="color: #d3869b; font-weight: bold;">0.01</span>), ]
Body <span style=
"color: #d3869b;">&lt;-</span> DR[which(DR$log2FoldChange &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>),]
Leg <span style=
"color: #d3869b;">&lt;-</span> DR[which(DR$log2FoldChange &gt; <span style="color: #d3869b; font-weight: bold;">2</span>), ]
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org87b407d" class="outline-4">
          <h4 id="org87b407d"><span class=
          "section-number-4">4.1.6</span> Save lists of the
          respective up-regulated genes</h4>
          <div class="outline-text-4" id="text-4-1-6">
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-R">write.table(Body, file=<span style=
              "color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/Deseq-Genes/Body.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
write.table(Leg, file=<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/Deseq-Genes/Leg.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
write.table(res, file=<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/Deseq-Genes/total.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org2a5a15e" class="outline-4">
          <h4 id="org2a5a15e"><span class=
          "section-number-4">4.1.7</span> Create a new analysis
          design</h4>
          <div class="outline-text-4" id="text-4-1-7">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">newdd <span style=
              "color: #d3869b;">&lt;-</span> dds
design(newdd) <span style=
"color: #d3869b;">&lt;-</span> formula(~part + part:pesticides)
newdd <span style="color: #d3869b;">&lt;-</span> DESeq(newdd)
newres <span style="color: #d3869b;">&lt;-</span> results(newdd)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org2bd61f9" class="outline-4">
          <h4 id="org2bd61f9"><span class=
          "section-number-4">4.1.8</span> Prepare the data for
          pheatmap plotting</h4>
          <div class="outline-text-4" id="text-4-1-8">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">select <span style=
              "color: #d3869b;">&lt;-</span> order(rowMeans(counts(dds, normalized=<span style="color: #fabd2f;">FALSE</span>)), decreasing = <span style="color: #fabd2f;">TRUE</span>)[<span style="color: #d3869b; font-weight: bold;">1</span>:<span style="color: #d3869b; font-weight: bold;">20</span>]
df <span style=
"color: #d3869b;">&lt;-</span> as.data.frame(colData(dds)[,c(<span style="color: #b8bb26;">"pesticides"</span>,<span style="color: #b8bb26;">"part"</span>)])
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org13d8838" class="outline-4">
          <h4 id="org13d8838"><span class=
          "section-number-4">4.1.9</span> Integrity plots</h4>
          <div class="outline-text-4" id="text-4-1-9">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">jpeg(<span style=
              "color: #b8bb26;">"generalfigures/plotMA_deseq.jpg"</span>)
plotMA(results)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/plotcounts_deseq.jpg"</span>)
plotCounts(data, gene=which.min(results$padj), intgroup = <span style="color: #b8bb26;">"part"</span>)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/meanSdvsd_deseq.jpg"</span>)
vsn::meanSdPlot(assay(vsd))
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/meadnSdrld_deseq.jpg"</span>)
vsn::meanSdPlot(assay(rld))
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/meanSdntd_deseq.jpg"</span>)
vsn::meanSdPlot(assay(ntd))
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/pcaplot_deseq.jpg"</span>, width = <span style="color: #d3869b; font-weight: bold;">800</span>, height=<span style="color: #d3869b; font-weight: bold;">800</span>)
plotPCA(vsd, intgroup=c(<span style=
"color: #b8bb26;">"part"</span>, <span style=
"color: #b8bb26;">"pesticides"</span>))
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/pheatmapplotntd.jpg"</span>, width=<span style="color: #d3869b; font-weight: bold;">800</span>, height=<span style="color: #d3869b; font-weight: bold;">800</span>)
pheatmap(assay(ntd)[select,], cluster_rows=<span style=
"color: #fabd2f;">FALSE</span>, show_rownames=<span style=
"color: #fabd2f;">TRUE</span>, cluster_cols=<span style=
"color: #fabd2f;">TRUE</span>, annotation_col=df)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/pheatmapplotvsd.jpg"</span>, width=<span style="color: #d3869b; font-weight: bold;">800</span>, height=<span style="color: #d3869b; font-weight: bold;">800</span>)
pheatmap(assay(vsd)[select,], cluster_rows=<span style=
"color: #fabd2f;">FALSE</span>, show_rownames=<span style=
"color: #fabd2f;">TRUE</span>, cluster_cols=<span style=
"color: #fabd2f;">FALSE</span>, annotation_col=df)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/pheatmapplotrld.jpg"</span>, width=<span style="color: #d3869b; font-weight: bold;">800</span>, height=<span style="color: #d3869b; font-weight: bold;">800</span>)
pheatmap(assay(rld)[select,], cluster_rows=<span style=
"color: #fabd2f;">FALSE</span>, show_rownames=<span style=
"color: #fabd2f;">TRUE</span>, cluster_cols=<span style=
"color: #fabd2f;">FALSE</span>, annotation_col=df)
dev.off()
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org6a781d1" class="outline-4">
          <h4 id="org6a781d1"><span class=
          "section-number-4">4.1.10</span> Another Deseq
          Design</h4>
          <div class="outline-text-4" id="text-4-1-10">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">
<span style="color: #d3869b;">library</span>(tidyverse)
vstarray <span style="color: #d3869b;">&lt;-</span> assay(vsd)

range <span style="color: #d3869b;">&lt;-</span> vstarray[]
names <span style="color: #d3869b;">&lt;-</span> rownames(range)
maxs <span style="color: #d3869b;">&lt;-</span> rowMaxs(range)
mins <span style="color: #d3869b;">&lt;-</span> rowMins(range)

maxs <span style="color: #d3869b;">&lt;-</span> maxs-mins
pt <span style="color: #d3869b;">&lt;-</span> tibble(names, maxs)
pt
pt <span style="color: #d3869b;">&lt;-</span> pt <span style=
"color: #d3869b;">%&gt;%</span> filter(maxs &gt; <span style=
"color: #d3869b; font-weight: bold;">10</span>)
pt
ggplot(pt, aes(x=names, y= maxs)) + geom_col()
descending <span style=
"color: #d3869b;">&lt;-</span> arrange(pt, desc(maxs))
descending <span style=
"color: #d3869b;">&lt;-</span> factor(descending[<span style=
"color: #b8bb26;">"maxs"</span>])
descending <span style=
"color: #d3869b;">&lt;-</span> tibble(row = seq(length(descending)), descending)
ggplot(descending, aes(x=row, y= descending)) + geom_col()

sum(results$padj &lt; <span style=
"color: #d3869b; font-weight: bold;">0.05</span>, na.rm=T)
res <span style="color: #d3869b;">&lt;-</span> results
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org2f9f6a4" class="outline-4">
          <h4 id="org2f9f6a4"><span class=
          "section-number-4">4.1.11</span> Altered Selection of
          genes</h4>
          <div class="outline-text-4" id="text-4-1-11">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">
Upregulated <span style=
"color: #d3869b;">&lt;-</span> res[ which(res$padj &lt; <span style="color: #d3869b; font-weight: bold;">0.03</span> &amp; res$log2FoldChange &gt; <span style="color: #d3869b; font-weight: bold;">0</span>), ]
DownRegulated <span style=
"color: #d3869b;">&lt;-</span> res[ which(res$padj &lt; <span style="color: #d3869b; font-weight: bold;">0.03</span> &amp; res$log2FoldChange &lt; <span style="color: #d3869b; font-weight: bold;">0</span>), ]
DownRegulated[order(DownRegulated$padj), ]
head(DownRegulated$padj)
D <span style=
"color: #d3869b;">&lt;-</span> rownames(DownRegulated)
Up <span style="color: #d3869b;">&lt;-</span> rownames(Upregulated)
DR <span style=
"color: #d3869b;">&lt;-</span> res[ which(res$padj &lt; <span style="color: #d3869b; font-weight: bold;">0.03</span>), ]
DR[order(DR$padj),]
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org8c7c5a7" class="outline-4">
          <h4 id="org8c7c5a7"><span class=
          "section-number-4">4.1.12</span> Save new selection to
          file</h4>
          <div class="outline-text-4" id="text-4-1-12">
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-R">write.table(D, file=<span style=
              "color: #b8bb26;">"Genes/DownRegulated.txt"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">FALSE</span>, row.names=<span style="color: #fabd2f;">FALSE</span>, sep=<span style="color: #b8bb26;">","</span>)
write.table(Up, file=<span style=
"color: #b8bb26;">"Genes/UpRegulated.txt"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">FALSE</span>, row.names=<span style="color: #fabd2f;">FALSE</span>, sep=<span style="color: #b8bb26;">","</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org920e013" class="outline-4">
          <h4 id="org920e013"><span class=
          "section-number-4">4.1.13</span> Extra integrity
          plot</h4>
          <div class="outline-text-4" id="text-4-1-13">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">d <span style=
              "color: #d3869b;">&lt;-</span> mcols(Deseq,use.names=<span style=
              "color: #fabd2f;">TRUE</span>)
a <span style=
"color: #d3869b;">&lt;-</span> data.frame(rownumb = seq(nrow(d)), d)
a <span style=
"color: #d3869b;">&lt;-</span> data.frame(rownumb = seq(nrow(d)), basemean = d[,<span style="color: #d3869b; font-weight: bold;">1</span>])
<span style="color: #d3869b;">library</span>(ggplot2)
ggplot(a, aes(x=rownumb, y=dispGeneEst)) + geom_point()
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgded38dd" class="outline-4">
          <h4 id="orgded38dd"><span class=
          "section-number-4">4.1.14</span> <span class=
          "todo TODO">TODO</span> Extra EdgeR for venn
          diagrams</h4>
          <div class="outline-text-4" id="text-4-1-14">
            <p>This is mostly contained in the EdgeR section.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">
<span style="color: #928374;">#</span><span style=
"color: #928374;">! EdgeR section ----</span>
<span style="color: #d3869b;">library</span>(edgeR)
<span style="color: #928374;"># </span><span style=
"color: #928374;">EdgR dataset from tximport</span>
counts <span style="color: #d3869b;">&lt;-</span> txi$counts
length <span style="color: #d3869b;">&lt;-</span> txi$length
normMat <span style=
"color: #d3869b;">&lt;-</span> length / exp(rowMeans(log(length)))
normCts <span style="color: #d3869b;">&lt;-</span> counts / normMat
eff.lib <span style=
"color: #d3869b;">&lt;-</span> calcNormFactors(normCts) * colSums(normCts)
normMat <span style=
"color: #d3869b;">&lt;-</span> sweep(normMat, <span style=
"color: #d3869b; font-weight: bold;">2</span>, eff.lib, <span style="color: #b8bb26;">"*"</span>)
normMat <span style="color: #d3869b;">&lt;-</span> log(normMat)
y <span style="color: #d3869b;">&lt;-</span> DGEList(counts)
y <span style=
"color: #d3869b;">&lt;-</span> scaleOffset(y, normMat)



<span style="color: #928374;"># </span><span style=
"color: #928374;">EdgR heatmap</span>
logcpm <span style="color: #d3869b;">&lt;-</span> cpm(EdgeR)
meta <span style=
"color: #d3869b;">&lt;-</span> read.csv(<span style=
"color: #b8bb26;">"metadata.csv"</span>, sep= <span style=
"color: #b8bb26;">","</span>)
pest <span style=
"color: #d3869b;">&lt;-</span> factor(meta$pesticides, levels=c(<span style="color: #b8bb26;">"perm"</span>, <span style="color: #b8bb26;">"deet"</span>, <span style="color: #b8bb26;">"control"</span>))
part <span style=
"color: #d3869b;">&lt;-</span> factor(meta$part, levels=c(<span style="color: #b8bb26;">"leg"</span>, <span style="color: #b8bb26;">"body"</span>))
design <span style=
"color: #d3869b;">&lt;-</span> model.matrix(~<span style=
"color: #d3869b; font-weight: bold;">0</span> + pest + part)
design
keep <span style=
"color: #d3869b;">&lt;-</span> filterByExpr(y, design)
EdgeR <span style="color: #d3869b;">&lt;-</span> y[keep, ]
estimateDisp(EdgeR)
y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMCommonDisp(EdgeR, design)
y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMTrendedDisp(y, design)
y <span style=
"color: #d3869b;">&lt;-</span> estimateGLMTagwiseDisp(y, design)
est <span style=
"color: #d3869b;">&lt;-</span> estimateDisp(EdgeR, design, robust=<span style="color: #fabd2f;">TRUE</span>)
design
fit <span style="color: #d3869b;">&lt;-</span> glmQLFit(y, design)
lrt <span style=
"color: #d3869b;">&lt;-</span> glmLRT(fit, coef=<span style=
"color: #d3869b; font-weight: bold;">1</span>:<span style=
"color: #d3869b; font-weight: bold;">4</span>)
test <span style=
"color: #d3869b;">&lt;-</span> glmQLFTest(fit, coef=<span style=
"color: #d3869b; font-weight: bold;">1</span>:<span style=
"color: #d3869b; font-weight: bold;">4</span>)
lrc$PValue
lrt

test$logFC.pestperm - test$logFC.pestdeet

ggplot(test$table, aes(y=logFC.partleg, x=seq(nrow(test)))) + geom_hex()
<span style="color: #928374;">#</span><span style=
"color: #928374;">additional analysis----</span>
table <span style="color: #d3869b;">&lt;-</span> test$table
body <span style=
"color: #d3869b;">&lt;-</span> table[table$logFC.partbody &gt; <span style="color: #d3869b; font-weight: bold;">2</span>, ]
leg <span style=
"color: #d3869b;">&lt;-</span> table[table$logFC.partbody &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>, ]
table <span style="color: #d3869b;">&lt;-</span> body
diff <span style=
"color: #d3869b;">&lt;-</span> table$logFC.pestcontrol - table$logFC.pestdeet
<span style="color: #d3869b;">library</span>(tidyverse)
data <span style=
"color: #d3869b;">&lt;-</span> tibble(data = diff, rows = seq(length(diff)))
ggplot(data, aes(x=rows, y=data)) + geom_point()
table$diff <span style="color: #d3869b;">&lt;-</span> diff
cont <span style=
"color: #d3869b;">&lt;-</span> table[table$diff &gt; <span style=
"color: #d3869b; font-weight: bold;">2</span>, ]
deet <span style=
"color: #d3869b;">&lt;-</span> table[table$diff &lt; -<span style=
"color: #d3869b; font-weight: bold;">2</span>, ]
diff2 <span style=
"color: #d3869b;">&lt;-</span> table$logFC.pestcontrol - table$logFC.pestperm
table$diff2 <span style="color: #d3869b;">&lt;-</span> diff2
cont2 <span style=
"color: #d3869b;">&lt;-</span> table[table$diff2 &gt; <span style=
"color: #d3869b; font-weight: bold;">2</span>, ]
perm <span style=
"color: #d3869b;">&lt;-</span> table[table$diff2 &lt; -<span style=
"color: #d3869b; font-weight: bold;">2</span>, ]



<span style="color: #d3869b;">library</span>(VennDiagram)
futile.logger::flog.threshold(futile.logger::ERROR, name = <span style="color: #b8bb26;">"VennDiagramLogger"</span>)
Legcont1 <span style="color: #d3869b;">&lt;-</span> cont
Legcont2 <span style="color: #d3869b;">&lt;-</span> cont2
deet1 <span style="color: #d3869b;">&lt;-</span> deet
perm1 <span style="color: #d3869b;">&lt;-</span> perm
d <span style=
"color: #d3869b;">&lt;-</span> data.frame(Pest = c(rep(c(<span style="color: #b8bb26;">"DEET"</span>, <span style="color: #b8bb26;">"DEET"</span>, <span style="color: #b8bb26;">"PERM"</span>, <span style="color: #b8bb26;">"PERM"</span>))),
                Part = c(rep(<span style=
"color: #b8bb26;">"Body"</span>, <span style=
"color: #d3869b; font-weight: bold;">4</span>), rep(<span style=
"color: #b8bb26;">"Leg"</span>, <span style=
"color: #d3869b; font-weight: bold;">4</span>)),
                Names = c(rep(c(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), <span style=
"color: #d3869b; font-weight: bold;">4</span>)),
                GeneCount = c(nrow(deet), nrow(cont), nrow(perm), nrow(cont2), nrow(deet1), nrow(Legcont1), nrow(perm1), nrow(Legcont2)))

write.table(d, file=<span style=
"color: #b8bb26;">"Genes/regulation.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">TRUE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)
write.table(rownames(perm), file=<span style=
"color: #b8bb26;">"Genes/perm.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)

pl ggplot(d, aes(x=Names, y = GeneCount, fill=Names)) + geom_col()
venn.diagram(
  x = list(rownames(deet), rownames(cont)),
  category.names = c(<span style=
"color: #b8bb26;">"DEET"</span> , <span style=
"color: #b8bb26;">"Control"</span>),
  filename = <span style=
"color: #b8bb26;">"Deetvcontorlvleg.png"</span>,
  compression = <span style="color: #b8bb26;">"lzw"</span>,


  lwd = <span style="color: #d3869b; font-weight: bold;">2</span>,
  lty = <span style="color: #b8bb26;">'blank'</span>,
  fill = c(<span style="color: #b8bb26;">"red"</span>, <span style=
"color: #b8bb26;">"blue"</span>),
)
grid.draw(tmp)

write.table(rownames(perm), file=<span style=
"color: #b8bb26;">"Genes/perm.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)
write.table(rownames(deet), file=<span style=
"color: #b8bb26;">"Genes/deet.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)
write.table(rownames(cont), file=<span style=
"color: #b8bb26;">"Genes/deetcont.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)
write.table(rownames(cont2), file=<span style=
"color: #b8bb26;">"Genes/permcont.csv"</span>, quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)

ggplot(contdata, aes(x=rows, y=data)) + geom_point()

rownames(cont)
<span style="color: #928374;"># </span><span style=
"color: #928374;">EdgeR plots ----</span>
jpeg(<span style=
"color: #b8bb26;">"generalfigures/BCVplot_edgeR.jpg"</span>)
plotBCV(est)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/QLDISP_edgeR.jpg"</span>)
plotQLDisp(fit)
dev.off()

jpeg(<span style=
"color: #b8bb26;">"generalfigures/MDS_edgeR.jpg"</span>)
plotMDS(logcpm)
dev.off()


<span style="color: #928374;"># </span><span style=
"color: #928374;">jpeg("generalfigur&gt;es/SpliceDGE_edgeR.jpg")</span>
<span style="color: #928374;"># </span><span style=
"color: #928374;">plotSpliceDGE(logcpm)</span>
<span style="color: #928374;"># </span><span style=
"color: #928374;">dev.off()</span>

<span style="color: #928374;"># </span><span style=
"color: #928374;">end ----</span>
<span style="color: #d3869b;">library</span>(matrixStats)
stats <span style="color: #d3869b;">&lt;-</span> txi$abundance
tpm <span style=
"color: #d3869b;">&lt;-</span> transform(stats, sd=rowSds(stats), avg=rowMeans(stats), median = rowMedians(stats))

dge <span style="color: #d3869b;">&lt;-</span> DGEList(txi$counts)
cpm <span style=
"color: #d3869b;">&lt;-</span> cpm(dge, log=<span style=
"color: #fabd2f;">TRUE</span>)
head(cpm)
data.frame(cpm)
cpmtibble <span style=
"color: #d3869b;">&lt;-</span> as_tibble(cpm, rownames=<span style=
"color: #b8bb26;">"geneID"</span>)
cpmpivot <span style=
"color: #d3869b;">&lt;-</span> pivot_longer(cpmtibble, cols=seq(<span style="color: #d3869b; font-weight: bold;">2</span>, ncol(cpmtibble)), names_to = <span style="color: #b8bb26;">"samples"</span>, values_to = <span style="color: #b8bb26;">"expression"</span>)



ggplot(tpm) +
  aes(x = sd, y = median) +
  geom_hex()

ggplot(tpm) +
  aes(x = sd, y = avg) +
  geom_point(shape=<span style=
"color: #d3869b; font-weight: bold;">16</span>, size=<span style=
"color: #d3869b; font-weight: bold;">2</span>) +
  geom_smooth(method=lm) +
  geom_hex() +
  labs(y=<span style=
"color: #b8bb26;">"Median"</span>, x = <span style=
"color: #b8bb26;">"Standard deviation"</span>, title=<span style=
"color: #b8bb26;">"Transcripts per million (TPM)"</span>, subtitle=<span style="color: #b8bb26;">"unfiltered, non-normalized data"</span>) +
  theme_classic() +
  theme_dark() +
  theme_bw()

ggplot(cpmpivot) +
  aes(x=samples, y=expression, fill=samples) +
  geom_violin(trim = <span style=
"color: #fabd2f;">FALSE</span>, show.legend = <span style=
"color: #fabd2f;">FALSE</span>) +
  stat_summary(fun = <span style=
"color: #b8bb26;">"median"</span>,geom = <span style=
"color: #b8bb26;">"point"</span>,shape = <span style=
"color: #d3869b; font-weight: bold;">95</span>,size = <span style=
"color: #d3869b; font-weight: bold;">10</span>,color = <span style=
"color: #b8bb26;">"black"</span>,show.legend = <span style=
"color: #fabd2f;">FALSE</span>) +
  labs(y=<span style=
"color: #b8bb26;">"log2 expression"</span>, x = <span style=
"color: #b8bb26;">"sample"</span>,title=<span style=
"color: #b8bb26;">"Log2 Counts per Million (CPM)"</span>,subtitle=<span style="color: #b8bb26;">"unfiltered, non-normalized"</span>,caption=paste0(<span style="color: #b8bb26;">"produced on "</span>, Sys.time())) +
  theme_bw()

keepers <span style=
"color: #d3869b;">&lt;-</span> rowSums(cpm &gt; <span style=
"color: #d3869b; font-weight: bold;">1</span>)&gt;=<span style=
"color: #d3869b; font-weight: bold;">3</span>
table(rowSums(dge$counts==<span style=
"color: #d3869b; font-weight: bold;">0</span>)==<span style=
"color: #d3869b; font-weight: bold;">10</span>)


<span style="color: #928374;"># </span><span style=
"color: #928374;">venndiagrams ----</span>

<span style="color: #d3869b;">library</span>(VennDiagram)


bodygenes <span style="color: #d3869b;">&lt;-</span> names(Deseq)
bodygenes <span style=
"color: #d3869b;">&lt;-</span> bodygenes[!bodygenes <span style=
"color: #d3869b;">%in%</span> rownames(Leg)]
leggenes <span style="color: #d3869b;">&lt;-</span> names(Deseq)
leggenes <span style=
"color: #d3869b;">&lt;-</span> leggenes[!leggenes <span style=
"color: #d3869b;">%in%</span> rownames(Body)]
names(Deseq) - rownames(Body)

<span style="color: #928374;">#</span>
bodyup <span style=
"color: #d3869b;">&lt;-</span> table[table[<span style=
"color: #b8bb26;">"partleg"</span>] &gt; <span style=
"color: #d3869b; font-weight: bold;">0</span>]


<span style="color: #928374;"># </span><span style=
"color: #928374;">Venn Diagram 1----</span>
futile.logger::flog.threshold(futile.logger::ERROR, name = <span style="color: #b8bb26;">"VennDiagramLogger"</span>)
venn.diagram(
  x = list(bodygenes, leggenes),
  category.names = c(<span style=
"color: #b8bb26;">"Body"</span> , <span style=
"color: #b8bb26;">"Leg"</span>),

  filename = <span style=
"color: #b8bb26;">'14_venn_diagramm.png'</span>,
  output=<span style="color: #fabd2f;">FALSE</span>,
  imagetype=<span style="color: #b8bb26;">"png"</span>,
  compression=<span style="color: #b8bb26;">"lzw"</span>,


  lwd = <span style="color: #d3869b; font-weight: bold;">2</span>,
  lty = <span style="color: #b8bb26;">'blank'</span>,
  fill = c(<span style="color: #b8bb26;">"red"</span>, <span style=
"color: #b8bb26;">"blue"</span>),
)


</pre>
            </div>
          </div>
        </div>
      </div>
      <div id="outline-container-orgaf886bd" class="outline-3">
        <h3 id="orgaf886bd"><span class=
        "section-number-3">4.2</span> EdgeR</h3>
        <div class="outline-text-3" id="text-4-2"></div>
        <div id="outline-container-org9a2e6f0" class="outline-4">
          <h4 id="org9a2e6f0"><span class=
          "section-number-4">4.2.1</span> Initial settings</h4>
          <div class="outline-text-4" id="text-4-2-1">
            <p>Directory and function setup, configure this when
            running the script. This is an attempt at simplifying
            the analysis process in R to a point that is hopefully
            nonspecific to deseq2 or edgeR. Enter the directory
            where the RNA-seq data is located, the folder
            containing the quant data, and the type of quant tool
            used (fishtype). The script should take care of the
            rest.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">setwd</span>(<span style=
              "color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/"</span>)
<span style="color: #d3869b;">source</span>(<span style=
"color: #b8bb26;">"scripts/functions.r"</span>)
directory <span style="color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/R/largeRNASEQ/"</span>
quantdatafoldername <span style=
"color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"CorrectedQuantData"</span>
fishtype <span style="color: #d3869b;">&lt;-</span> <span style=
"color: #b8bb26;">"sailfish"</span>
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgbed31c2" class="outline-4">
          <h4 id="orgbed31c2"><span class=
          "section-number-4">4.2.2</span> Do the initial processing
          of the data</h4>
          <div class="outline-text-4" id="text-4-2-2">
            <p>Imports the data and runs it through initial edgeR
            analysis using the functions created above. The
            functions do the initial manipulation of the data as
            detailed in the edgeR paper. This outputs the objects
            we will trim based on expression.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">a <span style=
              "color: #d3869b;">&lt;-</span> txi(directory, quantdatafoldername, <span style="color: #b8bb26;">"metadata.csv"</span>, fishtype)
<span style="color: #928374;">#</span><span style=
"color: #928374;">De &lt;- initialDeseq(a[[1]], a[[2]])</span>
Ed <span style=
"color: #d3869b;">&lt;-</span> initialEdgeR(a[[<span style=
"color: #d3869b; font-weight: bold;">1</span>]], a[[<span style=
"color: #d3869b; font-weight: bold;">2</span>]])
Eest <span style=
"color: #d3869b;">&lt;-</span> estEdgeR(Ed[[<span style=
"color: #d3869b; font-weight: bold;">1</span>]], Ed[[<span style=
"color: #d3869b; font-weight: bold;">2</span>]])
lrt <span style=
"color: #d3869b;">&lt;-</span> glmLRT(Eest, coef=<span style=
"color: #d3869b; font-weight: bold;">1</span>:<span style=
"color: #d3869b; font-weight: bold;">4</span>)
test <span style=
"color: #d3869b;">&lt;-</span> glmQLFTest(Eest, coef=<span style=
"color: #d3869b; font-weight: bold;">1</span>:<span style=
"color: #d3869b; font-weight: bold;">4</span>)
</pre>
            </div>
            <pre class="example" id="orga93d57e">
reading in files with read_tsv

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17


summarizing abundance

summarizing counts

summarizing length
</pre>
          </div>
        </div>
        <div id="outline-container-orgf695ace" class="outline-4">
          <h4 id="orgf695ace"><span class=
          "section-number-4">4.2.3</span> Partion the data into
          body and leg tables</h4>
          <div class="outline-text-4" id="text-4-2-3">
            <p>The Table object from the test object is separated
            into a body and a leg section, where the genes in the
            leg section are down regulated in the body and vice
            versa.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">
table <span style="color: #d3869b;">&lt;-</span> test$table
body <span style=
"color: #d3869b;">&lt;-</span> table[table$logFC.partbody &gt; <span style="color: #d3869b; font-weight: bold;">2</span>, ]
leg <span style=
"color: #d3869b;">&lt;-</span> table[table$logFC.partbody &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>, ]
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orga85c1f4" class="outline-4">
          <h4 id="orga85c1f4"><span class=
          "section-number-4">4.2.4</span> Save the data tables to a
          file</h4>
          <div class="outline-text-4" id="text-4-2-4">
            <p>Configure this to fit your computer.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">setwd</span>(<span style=
              "color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/"</span>). This section saves csv files with the expression data from the tables in the previous section.
write.table(table, file=<span style=
"color: #b8bb26;">"edgeR-Genes/TotalExpr.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
write.table(leg, file=<span style=
"color: #b8bb26;">"edgeR-Genes/legExpr.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
write.table(body, file=<span style=
"color: #b8bb26;">"edgeR-Genes/bodyExpr.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">TRUE</span>, sep=<span style="color: #b8bb26;">","</span>)
</pre>
            </div>
            <pre class="example">
Error in as.data.frame.default(x[[i]], optional = TRUE): cannot coerce class ‘"function"’ to a data.frame
Traceback:

1. write.table(table, file = "edgeR-Genes/TotalExpr.csv", quote = FALSE,
 .     col.names = TRUE, row.names = TRUE, sep = ",")
2. data.frame(x)
3. as.data.frame(x[[i]], optional = TRUE)
4. as.data.frame.default(x[[i]], optional = TRUE)
5. stop(gettextf("cannot coerce class %s to a data.frame", sQuote(deparse(class(x))[1L])),
 .     domain = NA)
</pre>
          </div>
        </div>
        <div id="outline-container-orgd77a44b" class="outline-4">
          <h4 id="orgd77a44b"><span class=
          "section-number-4">4.2.5</span> Find the relative
          expression values when compared to the control</h4>
          <div class="outline-text-4" id="text-4-2-5">
            <p>This is the main comparison with the pesticides done
            with the edgeR table. The control is subtracted from
            the pesticide expression to give a relative expression
            value. This is not necessary in Deseq and is instead
            done by manipulating the design.</p>
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-R">deetvcontrol <span style=
              "color: #d3869b;">&lt;-</span> table$logFC.pestdeet - table$logFC.pestcontrol
permvcontrol <span style=
"color: #d3869b;">&lt;-</span> table$logFC.pestperm - table$logFC.pestcontrol
deetvcontrolvbody <span style=
"color: #d3869b;">&lt;-</span> body$logFC.pestdeet - body$logFC.pestcontrol
permvcontrolvbody <span style=
"color: #d3869b;">&lt;-</span> body$logFC.pestperm - body$logFC.pestcontrol
deetvcontrolvleg <span style=
"color: #d3869b;">&lt;-</span> leg$logFC.pestdeet - leg$logFC.pestcontrol
permvcontrolvleg <span style=
"color: #d3869b;">&lt;-</span> leg$logFC.pestperm - leg$logFC.pestcontrol

table$deetvcontrol <span style=
"color: #d3869b;">&lt;-</span> deetvcontrol
table$permvcontrol <span style=
"color: #d3869b;">&lt;-</span> permvcontrol
body$deetvcontrol <span style=
"color: #d3869b;">&lt;-</span> deetvcontrolvbody
body$permvcontrol <span style=
"color: #d3869b;">&lt;-</span> permvcontrolvbody
leg$deetvcontrol <span style=
"color: #d3869b;">&lt;-</span> deetvcontrolvleg
leg$permvcontrol <span style=
"color: #d3869b;">&lt;-</span> permvcontrolvleg
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgd98723b" class="outline-4">
          <h4 id="orgd98723b"><span class=
          "section-number-4">4.2.6</span> Selection of the
          data</h4>
          <div class="outline-text-4" id="text-4-2-6">
            <p>Selects only the columns that have an expression
            value greater than 2(up-regulated) or less than
            -2(down-regulated). This is the same selection done
            earlier in the script with the body and leg.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">updeet <span style=
              "color: #d3869b;">&lt;-</span> table[table$deetvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downdeet <span style=
"color: #d3869b;">&lt;-</span> table[table$deetvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]



updeetbody <span style=
"color: #d3869b;">&lt;-</span> body[body$deetvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downdeetbody <span style=
"color: #d3869b;">&lt;-</span> body[body$deetvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
updeetleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$deetvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downdeetleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$deetvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]


upperm <span style=
"color: #d3869b;">&lt;-</span> table[table$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downperm <span style=
"color: #d3869b;">&lt;-</span> table[table$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
uppermbody <span style=
"color: #d3869b;">&lt;-</span> body[body$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downpermbody <span style=
"color: #d3869b;">&lt;-</span> body[body$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
uppermleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downpermleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orga93e2f7" class="outline-4">
          <h4 id="orga93e2f7"><span class=
          "section-number-4">4.2.7</span> Create a csv for bar
          plotting</h4>
          <div class="outline-text-4" id="text-4-2-7">
            <p>This is just a simple organization of the number of
            genes deferentially expressed for each comparison. The
            csv is saved using the write.table line, so change the
            path to fit your directory structure.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">d <span style=
              "color: #d3869b;">&lt;-</span> data.frame(Pest = c(rep(c(<span style="color: #b8bb26;">"DEET"</span>, <span style="color: #b8bb26;">"DEET"</span>, <span style="color: #b8bb26;">"PERM"</span>, <span style="color: #b8bb26;">"PERM"</span>))),
                Part = c(rep(<span style=
"color: #b8bb26;">"Body"</span>, <span style=
"color: #d3869b; font-weight: bold;">4</span>), rep(<span style=
"color: #b8bb26;">"Leg"</span>, <span style=
"color: #d3869b; font-weight: bold;">4</span>)),
                Names = c(rep(c(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), <span style=
"color: #d3869b; font-weight: bold;">4</span>)),
                GeneCount = c(nrow(downdeetbody), nrow(updeetbody), nrow(downpermbody), nrow(uppermbody), nrow(downdeetleg), nrow(updeetleg), nrow(downpermleg), nrow(uppermleg)))
write.table(d, file=<span style=
"color: #b8bb26;">"edgeR-Genes/venn-regulation.csv"</span>, quote=<span style="color: #fabd2f;">FALSE</span>, col.names=<span style="color: #fabd2f;">TRUE</span>, row.names=<span style="color: #fabd2f;">FALSE</span>, sep=<span style="color: #b8bb26;">","</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org058d359" class="outline-4">
          <h4 id="org058d359"><span class=
          "section-number-4">4.2.8</span> Gets the row-names</h4>
          <div class="outline-text-4" id="text-4-2-8">
            <p>This separates the data into just the gene names for
            each comparison. This is helpful for venn diagrams and
            other comparison.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">upperm <span style=
              "color: #d3869b;">&lt;-</span> table[table$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downperm <span style=
"color: #d3869b;">&lt;-</span> table[table$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
uppermbody <span style=
"color: #d3869b;">&lt;-</span> body[body$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downpermbody <span style=
"color: #d3869b;">&lt;-</span> body[body$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]
uppermleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$permvcontrol &gt; <span style="color: #d3869b; font-weight: bold;">2</span>,]
downpermleg <span style=
"color: #d3869b;">&lt;-</span> leg[leg$permvcontrol &lt; -<span style="color: #d3869b; font-weight: bold;">2</span>,]

uppermgenes <span style=
"color: #d3869b;">&lt;-</span> rownames(upperm)
downpermgenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downperm)
uppermleggenes <span style=
"color: #d3869b;">&lt;-</span> rownames(uppermleg)
downpermleggenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downpermleg)
uppermbodygenes <span style=
"color: #d3869b;">&lt;-</span> rownames(uppermbody)
downpermbodygenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downpermbody)

updeetgenes <span style=
"color: #d3869b;">&lt;-</span> rownames(updeet)
downdeetgenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downdeet)
updeetleggenes <span style=
"color: #d3869b;">&lt;-</span> rownames(updeetleg)
downdeetleggenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downdeetleg)
updeetbodygenes <span style=
"color: #d3869b;">&lt;-</span> rownames(updeetbody)
downdeetbodygenes <span style=
"color: #d3869b;">&lt;-</span> rownames(downdeetbody)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgb916788" class="outline-4">
          <h4 id="orgb916788"><span class=
          "section-number-4">4.2.9</span> Create a list of
          dataframes corresponding to the total, leg, and body</h4>
          <div class="outline-text-4" id="text-4-2-9">
            <p>Consolidates the genes into a list of dataframes for
            easy saving</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R">genelist <span style=
              "color: #d3869b;">&lt;-</span> list(upPerm = uppermgenes, downPerm = downpermgenes,
                upPermBody=uppermbodygenes, downPermBody=downpermbodygenes,
                upPermLeg = uppermleggenes, downPermLeg = downpermleggenes,
                upDeet = updeetgenes, downDeet = downdeetgenes,
                upDeetLeg = updeetleggenes, downDeetLeg = downdeetleggenes,
                upDeetBody = updeetbodygenes, downDeetBody = downdeetbodygenes, table=rownames(table), leg=rownames(leg), body=rownames(body))
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orge808cc6" class="outline-4">
          <h4 id="orge808cc6"><span class=
          "section-number-4">4.2.10</span> Save the genelist to
          files</h4>
          <div class="outline-text-4" id="text-4-2-10">
            <p>Saves all of the comparisons to file.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #fb4934;">for</span> (i <span style=
              "color: #fb4934;">in</span> seq(length(genelist))){
    namelist <span style=
"color: #d3869b;">&lt;-</span> names(genelist)
    write.table(genelist[i], file=paste(<span style=
"color: #b8bb26;">"edgeR-Genes/Genelists"</span>,<span style=
"color: #b8bb26;">"/"</span>, namelist[i], <span style=
"color: #b8bb26;">".csv"</span>, sep=<span style=
"color: #b8bb26;">""</span>), quote=<span style=
"color: #fabd2f;">FALSE</span>, col.names=<span style=
"color: #fabd2f;">FALSE</span>, row.names=<span style=
"color: #fabd2f;">FALSE</span>, sep=<span style=
"color: #b8bb26;">","</span>)
}
</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="outline-container-org3398bc5" class="outline-2">
      <h2 id="org3398bc5"><span class="section-number-2">5</span>
      Fasta Manipulation</h2>
      <div class="outline-text-2" id="text-5"></div>
      <div id="outline-container-orgb2cfdc6" class="outline-3">
        <h3 id="orgb2cfdc6"><span class=
        "section-number-3">5.1</span> Get Gene names</h3>
        <div class="outline-text-3" id="text-5-1">
          <p>This program just pulls the names of the genes out of
          the fasta file. There are probably less messy ways to do
          this. Online programs exist for this as well, but this is
          a fairly simple c++ program.</p>
          <div class="org-src-container">
            <pre class="src src-cpp"><span style=
            "color: #ebdbb2; font-weight: bold;">#include</span> <span style=
            "color: #fe8019;">&lt;</span><span style=
            "color: #b8bb26;">iostream</span><span style=
            "color: #fe8019;">&gt;</span>
<span style=
"color: #ebdbb2; font-weight: bold;">#include</span> <span style=
"color: #fe8019;">&lt;</span><span style=
"color: #b8bb26;">fstream</span><span style=
"color: #fe8019;">&gt;</span>
<span style=
"color: #ebdbb2; font-weight: bold;">#include</span> <span style=
"color: #fe8019;">&lt;</span><span style=
"color: #b8bb26;">string</span><span style=
"color: #fe8019;">&gt;</span>
<span style=
"color: #ebdbb2; font-weight: bold;">#include</span> <span style=
"color: #fe8019;">&lt;</span><span style=
"color: #b8bb26;">vector</span><span style=
"color: #fe8019;">&gt;</span>

<span style="color: #fabd2f;">int</span> <span style=
"color: #b8bb26;">main</span><span style=
"color: #fe8019;">(){</span>
    <span style="color: #d3869b;">std</span>::<span style=
"color: #fabd2f;">ifstream</span> <span style=
"color: #83a598;">in</span>;
    in.open<span style="color: #fb4934;">(</span><span style=
"color: #b8bb26;">"GeneReference/genelist.fasta"</span><span style=
"color: #fb4934;">)</span>;
    <span style="color: #d3869b;">std</span>::<span style=
"color: #fabd2f;">string</span> <span style=
"color: #83a598;">line</span>;
    <span style="color: #d3869b;">std</span>::<span style=
"color: #fabd2f;">ofstream</span> <span style=
"color: #83a598;">out</span>;
    out.open<span style="color: #fb4934;">(</span><span style=
"color: #b8bb26;">"GeneReference/listofgenes.csv"</span><span style="color: #fb4934;">)</span>;
    <span style="color: #fb4934;">if</span> <span style=
"color: #fb4934;">(</span>in.is_open<span style=
"color: #cc241d;">()</span><span style="color: #fb4934;">){</span>
        <span style="color: #fb4934;">while</span><span style=
"color: #cc241d;">(</span>getline<span style=
"color: #fe8019;">(</span>in, line<span style=
"color: #fe8019;">)</span><span style="color: #cc241d;">){</span>
            <span style="color: #fb4934;">if</span> <span style=
"color: #fe8019;">(</span>line<span style=
"color: #fb4934;">[</span><span style=
"color: #d3869b; font-weight: bold;">0</span><span style=
"color: #fb4934;">]</span> == <span style=
"color: #b8bb26;">'&gt;'</span><span style=
"color: #fe8019;">){</span>
                line.erase<span style=
"color: #fb4934;">(</span><span style=
"color: #d3869b; font-weight: bold;">0</span>, <span style=
"color: #d3869b; font-weight: bold;">1</span><span style=
"color: #fb4934;">)</span>;
                out &lt;&lt; line &lt;&lt; <span style=
"color: #d3869b;">std</span>::endl;
            <span style="color: #fe8019;">}</span>
        <span style="color: #cc241d;">}</span>
    <span style="color: #fb4934;">}</span>
<span style="color: #fe8019;">}</span>
</pre>
          </div>
        </div>
      </div>
    </div>
    <div id="outline-container-org6350d84" class="outline-2">
      <h2 id="org6350d84"><span class="section-number-2">6</span>
      Blast</h2>
    </div>
    <div id="outline-container-org2ccb604" class="outline-2">
      <h2 id="org2ccb604"><span class="section-number-2">7</span>
      Plotting</h2>
      <div class="outline-text-2" id="text-7">
        <p>This uses R and python to plot data.</p>
      </div>
      <div id="outline-container-org52bf935" class="outline-3">
        <h3 id="org52bf935"><span class=
        "section-number-3">7.1</span> Required Packages</h3>
        <div class="outline-text-3" id="text-7-1">
          <p>These packages are only required for plotting the
          data</p>
        </div>
        <div id="outline-container-orgcf806c3" class="outline-4">
          <h4 id="orgcf806c3"><span class=
          "section-number-4">7.1.1</span> R packages</h4>
          <div class="outline-text-4" id="text-7-1-1">
            <ul class="org-ul">
              <li>tidyverse (ggplot)</li>
              <li>ggpubr (correlation methods)</li>
            </ul>
          </div>
        </div>
        <div id="outline-container-org68ed04a" class="outline-4">
          <h4 id="org68ed04a"><span class=
          "section-number-4">7.1.2</span> Python packages</h4>
          <div class="outline-text-4" id="text-7-1-2">
            <ul class="org-ul">
              <li>Matplotlib</li>
              <li>pandas</li>
              <li>numpy</li>
              <li>matplotlib<sub>venn</sub></li>
            </ul>
          </div>
        </div>
      </div>
      <div id="outline-container-org1b10c20" class="outline-3">
        <h3 id="org1b10c20"><span class=
        "section-number-3">7.2</span> Venn Diagrams</h3>
        <div class="outline-text-3" id="text-7-2"></div>
        <div id="outline-container-org7c6d3d7" class="outline-4">
          <h4 id="org7c6d3d7"><span class=
          "section-number-4">7.2.1</span> Imports</h4>
          <div class="outline-text-4" id="text-7-2-1">
            <p>Change directory based on project</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #fb4934;">import</span> matplotlib.pyplot <span style=
              "color: #fb4934;">as</span> plt
<span style=
"color: #fb4934;">from</span> matplotlib_venn <span style=
"color: #fb4934;">import</span> venn2, venn2_circles, venn2_unweighted
<span style="color: #fb4934;">import</span> pandas <span style=
"color: #fb4934;">as</span> pd
<span style="color: #fb4934;">import</span> numpy <span style=
"color: #fb4934;">as</span> np
<span style="color: #fb4934;">import</span> os
os.chdir(<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq"</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org2771181" class="outline-4">
          <h4 id="org2771181"><span class=
          "section-number-4">7.2.2</span> Venn 1</h4>
          <div class="outline-text-4" id="text-7-2-2">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">data</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"edgeR-Genes/venn-regulation.csv"</span>)
plt.style.use(<span style="color: #b8bb26;">"ggplot"</span>)
<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots(<span style=
"color: #d3869b; font-weight: bold;">1</span>, <span style=
"color: #d3869b; font-weight: bold;">4</span>)


<span style="color: #83a598;">i</span> = <span style=
"color: #d3869b; font-weight: bold;">0</span>

<span style="color: #83a598;">maximum</span> = data[<span style=
"color: #b8bb26;">"GeneCount"</span>].<span style=
"color: #fe8019;">max</span>()

<span style="color: #fb4934;">for</span> pest <span style=
"color: #fb4934;">in</span> data[<span style=
"color: #b8bb26;">"Part"</span>].unique():
    <span style=
"color: #83a598;">pestdata</span> = data[data[<span style=
"color: #b8bb26;">"Part"</span>] == pest]
    <span style="color: #fb4934;">for</span> part <span style=
"color: #fb4934;">in</span> pestdata[<span style=
"color: #b8bb26;">"Pest"</span>].unique():
        partdata = pestdata[pestdata[<span style=
"color: #b8bb26;">"Pest"</span>] == part]
        x = partdata[<span style="color: #b8bb26;">"Names"</span>]
        y = partdata[<span style=
"color: #b8bb26;">"GeneCount"</span>]
        axes[i].bar(x, y, color=[<span style=
"color: #b8bb26;">"r"</span>, <span style=
"color: #b8bb26;">"b"</span>])
        axes[i].set_xticks(partdata[<span style=
"color: #b8bb26;">"Names"</span>])
        axes[i].set_ylim(<span style=
"color: #d3869b; font-weight: bold;">0</span>, maximum)
        <span style="color: #fb4934;">if</span> i != <span style=
"color: #d3869b; font-weight: bold;">0</span>:
            axes[i].get_yaxis().set_visible(<span style=
"color: #d3869b;">False</span>)
        axes[i].set_xlabel(part + <span style=
"color: #b8bb26;">"\n"</span> + pest)
        axes[<span style=
"color: #d3869b; font-weight: bold;">0</span>].set_ylabel(<span style="color: #b8bb26;">"Gene Count"</span>)

        i += <span style=
"color: #d3869b; font-weight: bold;">1</span>
fig.suptitle(<span style=
"color: #b8bb26;">"Gene Regulation"</span>)
fig.savefig(<span style=
"color: #b8bb26;">"fig.png"</span>, bbox_inches=<span style=
"color: #b8bb26;">"tight"</span>, dpi=<span style=
"color: #d3869b; font-weight: bold;">250</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgd96958e" class="outline-4">
          <h4 id="orgd96958e"><span class=
          "section-number-4">7.2.3</span> Venn 2</h4>
          <div class="outline-text-4" id="text-7-2-3">
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-python">plt.style.use(<span style=
              "color: #b8bb26;">"ggplot"</span>)

<span style=
"color: #fb4934;">from</span> matplotlib_venn <span style=
"color: #fb4934;">import</span> venn2, venn2_circles, venn2_unweighted
<span style=
"color: #fb4934;">from</span> matplotlib_venn <span style=
"color: #fb4934;">import</span> venn3, venn3_circles


<span style=
"color: #83a598;">deet</span> = pd.read_csv(<span style="color: #b8bb26;">"Genes/deet.csv"</span>, header=<span style="color: #d3869b;">None</span>)
deetcont = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/deetcont.csv"</span>, header=<span style=
"color: #d3869b;">None</span>)
perm = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/perm.csv"</span>, header=<span style=
"color: #d3869b;">None</span>)
permcont = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/permcont.csv"</span>, header=<span style=
"color: #d3869b;">None</span>)
genes = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/listofgenes.csv"</span>, header=<span style="color: #d3869b;">None</span>)
<span style="color: #fb4934;">def</span> <span style=
"color: #b8bb26;">compare</span>(s1, s2):
    c = <span style="color: #fe8019;">len</span>(<span style=
"color: #fe8019;">list</span>(<span style=
"color: #fe8019;">set</span>(s1.iloc[:, <span style=
"color: #d3869b; font-weight: bold;">0</span>]) &amp; <span style=
"color: #fe8019;">set</span>(s2.iloc[:, <span style=
"color: #d3869b; font-weight: bold;">0</span>])))
    <span style="color: #fb4934;">return</span>(c)

diff = compare(deet, genes)
<span style="color: #fe8019;">len</span>(deet)
<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots(<span style=
"color: #d3869b; font-weight: bold;">2</span>)
v1 = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(deet), <span style=
"color: #fe8019;">len</span>(deetcont), <span style=
"color: #fe8019;">len</span>(genes)-<span style=
"color: #fe8019;">len</span>(deetcont)-<span style=
"color: #fe8019;">len</span>(deet)), set_labels=(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), ax=axes[<span style=
"color: #d3869b; font-weight: bold;">0</span>])
v2 = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(perm), <span style=
"color: #fe8019;">len</span>(permcont), <span style=
"color: #fe8019;">len</span>(genes)-<span style=
"color: #fe8019;">len</span>(permcont)-<span style=
"color: #fe8019;">len</span>(perm)), set_labels=(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), ax=axes[<span style=
"color: #d3869b; font-weight: bold;">1</span>])
axes[<span style=
"color: #d3869b; font-weight: bold;">0</span>].set_title(<span style="color: #b8bb26;">"Deet"</span>)
axes[<span style=
"color: #d3869b; font-weight: bold;">1</span>].set_title(<span style="color: #b8bb26;">"Perm"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/DeetnPerm.png"</span>, bbox_inxhes=<span style="color: #b8bb26;">"tight"</span>, dpi=<span style="color: #d3869b; font-weight: bold;">250</span>)
plt.show()
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org1923289" class="outline-4">
          <h4 id="org1923289"><span class=
          "section-number-4">7.2.4</span> Venn 3</h4>
          <div class="outline-text-4" id="text-7-2-4">
            <p>This compares the expression of body and legs when
            compared to the total.</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">genes</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"GeneReference/listofgenes.csv"</span>, header=<span style="color: #d3869b;">None</span>)
body = pd.read_csv(<span style=
"color: #b8bb26;">"GeneReference/Body.csv"</span>)
leg = pd.read_csv(<span style=
"color: #b8bb26;">"GeneReference/Leg.csv"</span>)

<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()

v = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(body), <span style=
"color: #fe8019;">len</span>(leg),<span style=
"color: #fe8019;">len</span>(genes)-<span style=
"color: #fe8019;">len</span>(leg) - <span style=
"color: #fe8019;">len</span>(body)), set_labels=(<span style=
"color: #b8bb26;">"Body"</span>, <span style=
"color: #b8bb26;">"Leg"</span>), ax=axes)
v.get_patch_by_id(<span style=
"color: #b8bb26;">"10"</span>).set_color(<span style=
"color: #b8bb26;">"blue"</span>)
v.get_patch_by_id(<span style=
"color: #b8bb26;">"11"</span>).set_color(<span style=
"color: #b8bb26;">"blue"</span>)
v.get_patch_by_id(<span style=
"color: #b8bb26;">"01"</span>).set_color(<span style=
"color: #b8bb26;">"grey"</span>)
v.get_patch_by_id(<span style=
"color: #b8bb26;">"01"</span>).set_alpha(<span style=
"color: #d3869b; font-weight: bold;">0.5</span>)
axes.set_title(<span style="color: #b8bb26;">"Leg vs Body"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"figures/figure2/BodyvsLeg.png"</span>, bbox_inches=<span style="color: #b8bb26;">"tight"</span>, dpi=<span style="color: #d3869b; font-weight: bold;">250</span>)
fig.savefig(<span style=
"color: #b8bb26;">"figures/figure2/BodyvsLeg.pdf"</span>, bbox_inches=<span style="color: #b8bb26;">"tight"</span>, dpi=<span style="color: #d3869b; font-weight: bold;">250</span>)

plt.show()
</pre>
            </div>
            <div id="org2a353f0" class="figure">
              <p><img src=
              "./.ob-jupyter/d0c25b1b83e2445061be8a15a3fc07a21d49fa84.png"
              alt=
              "d0c25b1b83e2445061be8a15a3fc07a21d49fa84.png" /></p>
            </div>
          </div>
        </div>
        <div id="outline-container-org37ce54e" class="outline-4">
          <h4 id="org37ce54e"><span class=
          "section-number-4">7.2.5</span> Venn 4</h4>
          <div class="outline-text-4" id="text-7-2-5">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">genes</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"Genes/listofgenes.csv"</span>, header=<span style="color: #d3869b;">None</span>)
body = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Body.csv"</span>)
upDeetBody = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/upDeetBody.csv"</span>)
downDeetBody = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/downDeetBody.csv"</span>)


<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()

v = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(upDeetBody), <span style=
"color: #fe8019;">len</span>(downDeetBody), <span style=
"color: #fe8019;">len</span>(body)- <span style=
"color: #fe8019;">len</span>(upDeetBody)-<span style=
"color: #fe8019;">len</span>(downDeetBody)), set_labels=(<span style="color: #b8bb26;">"Up Regulated"</span>, <span style="color: #b8bb26;">"Down Regulated"</span>), ax=axes)
axes.set_title(<span style=
"color: #b8bb26;">"Deet Expression in Body Genes"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/DeetBody.png"</span>)
plt.show()
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org18dedf3" class="outline-4">
          <h4 id="org18dedf3"><span class=
          "section-number-4">7.2.6</span> Venn 5</h4>
          <div class="outline-text-4" id="text-7-2-6">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">leg</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"Genes/Leg.csv"</span>)
<span style=
"color: #83a598;">upDeetLeg</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/upDeetLeg.csv"</span>)
<span style=
"color: #83a598;">downDeetLeg</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/downDeetLeg.csv"</span>)

<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()
<span style=
"color: #83a598;">v</span> = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(upDeetLeg), <span style=
"color: #fe8019;">len</span>(downDeetLeg), <span style=
"color: #fe8019;">len</span>(leg)-<span style=
"color: #fe8019;">len</span>(upDeetLeg)-<span style=
"color: #fe8019;">len</span>(downDeetLeg)), set_labels=(<span style="color: #b8bb26;">"Up Regulated"</span>, <span style="color: #b8bb26;">"Down Regulated"</span>), ax=axes)
axes.set_title(<span style=
"color: #b8bb26;">"Deet Expression in Leg Genes"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/DeetLeg.png"</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org55791e5" class="outline-4">
          <h4 id="org55791e5"><span class=
          "section-number-4">7.2.7</span> Venn 6</h4>
          <div class="outline-text-4" id="text-7-2-7">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">leg</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"Genes/Leg.csv"</span>)
<span style=
"color: #83a598;">upPermLeg</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/upPermLeg.csv"</span>)
<span style=
"color: #83a598;">downPermLeg</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/downPermLeg.csv"</span>)

<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()
<span style=
"color: #83a598;">v</span> = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(upPermLeg), <span style=
"color: #fe8019;">len</span>(downPermLeg), <span style=
"color: #fe8019;">len</span>(leg)-<span style=
"color: #fe8019;">len</span>(downPermLeg)-<span style=
"color: #fe8019;">len</span>(upPermLeg)), set_labels=(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), ax=axes)
axes.set_title(<span style=
"color: #b8bb26;">"Perm Expression in Leg Genes"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/PermLeg.png"</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgb644410" class="outline-4">
          <h4 id="orgb644410"><span class=
          "section-number-4">7.2.8</span> Venn 7</h4>
          <div class="outline-text-4" id="text-7-2-8">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">body</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"Genes/Body.csv"</span>)
<span style=
"color: #83a598;">upPermBody</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/upPermBody.csv"</span>)
<span style=
"color: #83a598;">downPermBody</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/downPermLeg.csv"</span>)

<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()
<span style=
"color: #83a598;">v</span> = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(upPermBody), <span style=
"color: #fe8019;">len</span>(downPermBody), <span style=
"color: #fe8019;">len</span>(body)-<span style=
"color: #fe8019;">len</span>(upPermBody)-<span style=
"color: #fe8019;">len</span>(downPermBody)), set_labels=(<span style="color: #b8bb26;">"Up Regulated"</span>, <span style="color: #b8bb26;">"Down Regulated"</span>), ax=axes)
axes.set_title(<span style=
"color: #b8bb26;">"Perm Expression in Body Genes"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/PermBody.png"</span>)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orgf070555" class="outline-4">
          <h4 id="orgf070555"><span class=
          "section-number-4">7.2.9</span> Venn 8</h4>
          <div class="outline-text-4" id="text-7-2-9">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">genes</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"Genes/listofgenes.csv"</span>)
<span style=
"color: #83a598;">upPerm</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/upPerm.csv"</span>)
<span style=
"color: #83a598;">downPerm</span> = pd.read_csv(<span style=
"color: #b8bb26;">"Genes/Genelists/downPerm.csv"</span>)

<span style="color: #83a598;">fig</span>, <span style=
"color: #83a598;">axes</span> = plt.subplots()
<span style=
"color: #83a598;">v</span> = venn2_unweighted(subsets=(<span style=
"color: #fe8019;">len</span>(upPerm), <span style=
"color: #fe8019;">len</span>(downPerm), <span style=
"color: #fe8019;">len</span>(genes)-<span style=
"color: #fe8019;">len</span>(upPerm)-<span style=
"color: #fe8019;">len</span>(downPerm)), set_labels=(<span style=
"color: #b8bb26;">"Up Regulated"</span>, <span style=
"color: #b8bb26;">"Down Regulated"</span>), ax=axes)
axes.set_title(<span style=
"color: #b8bb26;">"Perm Expression"</span>)
fig.tight_layout()
fig.savefig(<span style=
"color: #b8bb26;">"VennDiagrams/RevisedDiagrams/Perm.png"</span>)
</pre>
            </div>
          </div>
        </div>
      </div>
      <div id="outline-container-orgd0c9136" class="outline-3">
        <h3 id="orgd0c9136"><span class=
        "section-number-3">7.3</span> Pearson Correlation</h3>
        <div class="outline-text-3" id="text-7-3">
          <p>This correlates the results from edgeR and Deseq2.
          Using this, the correlation can make the analysis tool
          interchangeable.</p>
          <p>:header-args: :tangle
          scripts/pearson-correlation.r</p>
        </div>
        <div id="outline-container-org7ded9eb" class="outline-4">
          <h4 id="org7ded9eb"><span class=
          "section-number-4">7.3.1</span> Libraries</h4>
          <div class="outline-text-4" id="text-7-3-1">
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">library</span>(<span style=
              "color: #b8bb26;">"tidyverse"</span>)
<span style="color: #d3869b;">library</span>(<span style=
"color: #b8bb26;">"ggpubr"</span>)
</pre>
            </div>
            <pre class="example" id="orgf39809c">
── [1mAttaching packages[22m ─────────────────────────────────────── tidyverse 1.3.1 ──

[32m✔[39m [34mggplot2[39m 3.3.3     [32m✔[39m [34mpurrr  [39m 0.3.4
[32m✔[39m [34mtibble [39m 3.1.2     [32m✔[39m [34mdplyr  [39m 1.0.6
[32m✔[39m [34mtidyr  [39m 1.1.3     [32m✔[39m [34mstringr[39m 1.4.0
[32m✔[39m [34mreadr  [39m 1.4.0     [32m✔[39m [34mforcats[39m 0.5.1

── [1mConflicts[22m ────────────────────────────────────────── tidyverse_conflicts() ──
[31m✖[39m [34mdplyr[39m::[32mfilter()[39m masks [34mstats[39m::filter()
[31m✖[39m [34mdplyr[39m::[32mlag()[39m    masks [34mstats[39m::lag()
</pre>
          </div>
        </div>
        <div id="outline-container-org4daa1fc" class="outline-4">
          <h4 id="org4daa1fc"><span class=
          "section-number-4">7.3.2</span> Import the data</h4>
          <div class="outline-text-4" id="text-7-3-2">
            <div class="org-src-container">
              <pre class="src src-jupyter-R">EdgeR <span style=
              "color: #d3869b;">&lt;-</span> read.csv(<span style=
              "color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/edgeR-Genes/bodyExpr.csv"</span>)
Deseq <span style=
"color: #d3869b;">&lt;-</span> read.csv(<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/Deseq-Genes/total.csv"</span>)
common <span style=
"color: #d3869b;">&lt;-</span> intersect(row.names(Deseq), row.names(EdgeR))
EdgeRCommon <span style=
"color: #d3869b;">&lt;-</span> EdgeR[common, ]
DeseqCommon <span style=
"color: #d3869b;">&lt;-</span> Deseq[common, ]

ECol <span style=
"color: #d3869b;">&lt;-</span> EdgeRCommon[<span style=
"color: #b8bb26;">"logFC.partbody"</span>]
DCol <span style="color: #d3869b;">&lt;-</span> -<span style=
"color: #d3869b; font-weight: bold;">1</span>*DeseqCommon[<span style="color: #b8bb26;">"log2FoldChange"</span>]
newD <span style=
"color: #d3869b;">&lt;-</span> data.frame(DCol, ECol)
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org00262bd" class="outline-4">
          <h4 id="org00262bd"><span class=
          "section-number-4">7.3.3</span> Plot the data</h4>
          <div class="outline-text-4" id="text-7-3-3">
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">library</span>(<span style=
              "color: #b8bb26;">"ggpubr"</span>)
pearson <span style=
"color: #d3869b;">&lt;-</span> ggscatter(newD, x = <span style=
"color: #b8bb26;">"log2FoldChange"</span>, y = <span style=
"color: #b8bb26;">"logFC.partbody"</span>,
          add = <span style=
"color: #b8bb26;">"reg.line"</span>, conf.int = <span style=
"color: #fabd2f;">TRUE</span>,
          cor.coef = <span style=
"color: #fabd2f;">TRUE</span>, cor.method = <span style=
"color: #b8bb26;">"pearson"</span>,
          xlab = <span style=
"color: #b8bb26;">"Deseq"</span>, ylab = <span style=
"color: #b8bb26;">"EdgeR"</span>)
pearson
ggsave(<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/figures/figure1/pearson.png"</span>, pearson, png())
ggsave(<span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/figures/figure1/pearson.pdf"</span>, pearson, pdf())

</pre>
            </div>
            <pre class="example">
`geom_smooth()` using formula 'y ~ x'

Saving 6.67 x 6.67 in image

`geom_smooth()` using formula 'y ~ x'

Saving 7 x 7 in image

`geom_smooth()` using formula 'y ~ x'

</pre>
            <div id="org53ec09a" class="figure">
              <p><img src=
              "./.ob-jupyter/f1067a6954fd040fbf8de1c030201143a06483aa.png"
              alt=
              "f1067a6954fd040fbf8de1c030201143a06483aa.png" /></p>
            </div>
          </div>
        </div>
        <div id="outline-container-orgfabe93d" class="outline-4">
          <h4 id="orgfabe93d"><span class=
          "section-number-4">7.3.4</span> Venn Diagram</h4>
          <div class="outline-text-4" id="text-7-3-4">
            <p>Doesn’t do what I wanted</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-R"><span style=
              "color: #d3869b;">library</span>(VennDiagram)
ECol <span style=
"color: #d3869b;">&lt;-</span> row.names(EdgeR[<span style=
"color: #b8bb26;">"logFC.partbody"</span>])
DCol <span style=
"color: #d3869b;">&lt;-</span> row.names(-<span style=
"color: #d3869b; font-weight: bold;">1</span>*Deseq[<span style=
"color: #b8bb26;">"log2FoldChange"</span>])
venn.diagram(
  x = list(na.omit(ECol), na.omit(DCol)),
  category.names = c(<span style=
"color: #b8bb26;">"EdgeR"</span>, <span style=
"color: #b8bb26;">"Deseq"</span>),
  filename = <span style=
"color: #b8bb26;">"/home/david/Documents/BenoitLab/RNA-seq/figures/figure1/vennBody.png"</span>,
  output=<span style="color: #fabd2f;">TRUE</span>
)
</pre>
            </div>
          </div>
        </div>
      </div>
      <div id="outline-container-orge733bf1" class="outline-3">
        <h3 id="orge733bf1"><span class=
        "section-number-3">7.4</span> Dotplot</h3>
        <div class="outline-text-3" id="text-7-4">
          <p>This figure plots the enrichment of specific genes.
          Ideal for small amounts of genes.</p>
        </div>
        <div id="outline-container-org32b8c95" class="outline-4">
          <h4 id="org32b8c95"><span class=
          "section-number-4">7.4.1</span> imports</h4>
          <div class="outline-text-4" id="text-7-4-1">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #fb4934;">import</span> numpy <span style=
              "color: #fb4934;">as</span> np
<span style=
"color: #fb4934;">import</span> matplotlib.pyplot <span style=
"color: #fb4934;">as</span> plt
<span style="color: #fb4934;">import</span> matplotlib
<span style="color: #fb4934;">import</span> pandas <span style=
"color: #fb4934;">as</span> pd
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org101ec2c" class="outline-4">
          <h4 id="org101ec2c"><span class=
          "section-number-4">7.4.2</span> Theme settings</h4>
          <div class="outline-text-4" id="text-7-4-2">
            <div class="org-src-container">
              <pre class="src src-jupyter-python">plt.<span style=
              "color: #83a598;">rcParams</span>[<span style=
              "color: #b8bb26;">"font.family"</span>] = <span style=
              "color: #b8bb26;">"Bahnschrift"</span>
<span style=
"color: #83a598;">cmap</span> = matplotlib.colors.LinearSegmentedColormap.from_list(
    <span style="color: #b8bb26;">""</span>, [<span style=
"color: #b8bb26;">"dodgerblue"</span>, <span style=
"color: #b8bb26;">"lightgrey"</span>]
)

</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org097ecf0" class="outline-4">
          <h4 id="org097ecf0"><span class=
          "section-number-4">7.4.3</span> Import</h4>
          <div class="outline-text-4" id="text-7-4-3">
            <p>Use the pandas package to import the csv file</p>
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">dotplotdata</span> = pd.read_csv(<span style=
              "color: #b8bb26;">"../GeneReference/dotplotdata.csv"</span>)  <span style="color: #928374;"># </span><span style="color: #928374;">infers header existance</span>

<span style=
"color: #83a598;">pesticide</span> = dotplotdata.Category
<span style="color: #83a598;">pathway</span> = dotplotdata.Pathway
<span style=
"color: #83a598;">enrichmentratio</span> = dotplotdata.Enrichment
<span style=
"color: #83a598;">pval</span> = dotplotdata[<span style="color: #b8bb26;">"P-Value"</span>]
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-orge3dca6e" class="outline-4">
          <h4 id="orge3dca6e"><span class=
          "section-number-4">7.4.4</span> Plot the figure</h4>
          <div class="outline-text-4" id="text-7-4-4">
            <div class="org-src-container">
              <pre class="src src-jupyter-python"><span style=
              "color: #83a598;">fig</span>, <span style=
              "color: #83a598;">ax</span> = plt.subplots(<span style=
              "color: #d3869b; font-weight: bold;">1</span>)
<span style="color: #83a598;">p</span> = ax.scatter(
    pathway, pesticide, c=pval, s=enrichmentratio * <span style=
"color: #d3869b; font-weight: bold;">3</span>, cmap=cmap, vmin=<span style="color: #d3869b; font-weight: bold;">0</span>, vmax=<span style="color: #d3869b; font-weight: bold;">0.05</span>
)
plt.legend(loc=<span style=
"color: #b8bb26;">"lower left"</span>, markerscale=<span style=
"color: #d3869b; font-weight: bold;">2.0</span>, scatterpoints=<span style="color: #d3869b; font-weight: bold;">1</span>, fontsize=<span style="color: #d3869b; font-weight: bold;">10</span>)
plt.xticks(rotation=<span style=
"color: #b8bb26;">"vertical"</span>)

<span style="color: #928374;"># </span><span style=
"color: #928374;">Legend:</span>
handles, labels = p.legend_elements(prop=<span style=
"color: #b8bb26;">"sizes"</span>, alpha=<span style=
"color: #d3869b; font-weight: bold;">0.6</span>, num=<span style=
"color: #d3869b; font-weight: bold;">4</span>, func=<span style=
"color: #fb4934;">lambda</span> x : x/<span style=
"color: #d3869b; font-weight: bold;">3</span>)
legend2 = ax.legend(
    handles,
    labels,
    loc=<span style="color: #b8bb26;">"upper right"</span>,
    title=<span style="color: #b8bb26;">"Enrichment Ratio"</span>,
    bbox_to_anchor=(<span style=
"color: #d3869b; font-weight: bold;">1.4</span>, <span style=
"color: #d3869b; font-weight: bold;">1.1</span>),
)

<span style="color: #928374;"># </span><span style=
"color: #928374;">Colorbar:</span>
cbar = fig.colorbar(p, shrink=<span style=
"color: #d3869b; font-weight: bold;">0.5</span>)
cbar.ax.set_ylabel(<span style=
"color: #b8bb26;">"p Value"</span>, rotation=<span style=
"color: #d3869b; font-weight: bold;">270</span>, labelpad=<span style="color: #d3869b; font-weight: bold;">15</span>)

<span style="color: #928374;"># </span><span style=
"color: #928374;">Title, labels, and visual modifications:</span>
plt.title(<span style=
"color: #b8bb26;">"Metabolic Pathway Enrichment"</span>)
plt.xlabel(<span style=
"color: #b8bb26;">"Metabolic Pathway"</span>)
plt.ylabel(<span style="color: #b8bb26;">"Pesticide"</span>)
ax.grid(axis=<span style=
"color: #b8bb26;">"x"</span>, linestyle=<span style=
"color: #b8bb26;">"dotted"</span>)
ax.spines[<span style=
"color: #b8bb26;">"top"</span>].set_visible(<span style=
"color: #d3869b;">False</span>)
ax.spines[<span style=
"color: #b8bb26;">"right"</span>].set_visible(<span style=
"color: #d3869b;">False</span>)

plt.show()
</pre>
            </div>
          </div>
        </div>
        <div id="outline-container-org763e16e" class="outline-4">
          <h4 id="org763e16e"><span class=
          "section-number-4">7.4.5</span> Save the Figure</h4>
          <div class="outline-text-4" id="text-7-4-5">
            <div class="org-src-container">
              <pre class=
              "src src-jupyter-python">plt.savefig(<span style=
              "color: #b8bb26;">'dotplot.pdf'</span>, dpi=<span style=
              "color: #d3869b; font-weight: bold;">300</span>, bbox_inches=<span style="color: #b8bb26;">'tight'</span>)
plt.savefig(<span style=
"color: #b8bb26;">'dotplot.jpg'</span>, dpi=<span style=
"color: #d3869b; font-weight: bold;">300</span>, bbox_inches=<span style="color: #b8bb26;">'tight'</span>)
</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="postamble" class="status">
    <p class="author">Author: David Lewis</p>
    <p class="date">Created: 2021-05-19 Wed 09:40</p>
  </div>
</body>
</html>
